<!DOCTYPE html>
<!--
	Interphase by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Espresso</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({jax: ["output/SVG"], tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
    <script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-xlarge.css" />
		</noscript>
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
    <style>
pre .hll { background-color: #ffffcc }
pre  { background: #f0f0f0; }
pre .c { color: #60a0b0; font-style: italic } /* Comment */
pre .err { border: 1px solid #FF0000 } /* Error */
pre .k { color: #007020; font-weight: bold } /* Keyword */
pre .o { color: #666666 } /* Operator */
pre .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
pre .cp { color: #007020 } /* Comment.Preproc */
pre .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
pre .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
pre .gd { color: #A00000 } /* Generic.Deleted */
pre .ge { font-style: italic } /* Generic.Emph */
pre .gr { color: #FF0000 } /* Generic.Error */
pre .gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre .gi { color: #00A000 } /* Generic.Inserted */
pre .go { color: #888888 } /* Generic.Output */
pre .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
pre .gs { font-weight: bold } /* Generic.Strong */
pre .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre .gt { color: #0044DD } /* Generic.Traceback */
pre .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
pre .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
pre .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
pre .kp { color: #007020 } /* Keyword.Pseudo */
pre .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
pre .kt { color: #902000 } /* Keyword.Type */
pre .m { color: #40a070 } /* Literal.Number */
pre .s { color: #4070a0 } /* Literal.String */
pre .na { color: #4070a0 } /* Name.Attribute */
pre .nb { color: #007020 } /* Name.Builtin */
pre .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
pre .no { color: #60add5 } /* Name.Constant */
pre .nd { color: #555555; font-weight: bold } /* Name.Decorator */
pre .ni { color: #d55537; font-weight: bold } /* Name.Entity */
pre .ne { color: #007020 } /* Name.Exception */
pre .nf { color: #06287e } /* Name.Function */
pre .nl { color: #002070; font-weight: bold } /* Name.Label */
pre .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
pre .nt { color: #062873; font-weight: bold } /* Name.Tag */
pre .nv { color: #bb60d5 } /* Name.Variable */
pre .ow { color: #007020; font-weight: bold } /* Operator.Word */
pre .w { color: #bbbbbb } /* Text.Whitespace */
pre .mb { color: #40a070 } /* Literal.Number.Bin */
pre .mf { color: #40a070 } /* Literal.Number.Float */
pre .mh { color: #40a070 } /* Literal.Number.Hex */
pre .mi { color: #40a070 } /* Literal.Number.Integer */
pre .mo { color: #40a070 } /* Literal.Number.Oct */
pre .sb { color: #4070a0 } /* Literal.String.Backtick */
pre .sc { color: #4070a0 } /* Literal.String.Char */
pre .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
pre .s2 { color: #4070a0 } /* Literal.String.Double */
pre .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
pre .sh { color: #4070a0 } /* Literal.String.Heredoc */
pre .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
pre .sx { color: #c65d09 } /* Literal.String.Other */
pre .sr { color: #235388 } /* Literal.String.Regex */
pre .s1 { color: #4070a0 } /* Literal.String.Single */
pre .ss { color: #517918 } /* Literal.String.Symbol */
pre .bp { color: #007020 } /* Name.Builtin.Pseudo */
pre .vc { color: #bb60d5 } /* Name.Variable.Class */
pre .vg { color: #bb60d5 } /* Name.Variable.Global */
pre .vi { color: #bb60d5 } /* Name.Variable.Instance */
pre .il { color: #40a070 } /* Literal.Number.Integer.Long */.syntax pre .hll { background-color: #49483e }
.syntax pre  { background: #272822; color: #f8f8f2 }
.syntax pre .c { color: #75715e } /* Comment */
.syntax pre .err { color: #960050; background-color: #1e0010 } /* Error */
.syntax pre .k { color: #66d9ef } /* Keyword */
.syntax pre .l { color: #ae81ff } /* Literal */
.syntax pre .n { color: #f8f8f2 } /* Name */
.syntax pre .o { color: #f92672 } /* Operator */
.syntax pre .p { color: #f8f8f2 } /* Punctuation */
.syntax pre .cm { color: #75715e } /* Comment.Multiline */
.syntax pre .cp { color: #75715e } /* Comment.Preproc */
.syntax pre .c1 { color: #75715e } /* Comment.Single */
.syntax pre .cs { color: #75715e } /* Comment.Special */
.syntax pre .gd { color: #f92672 } /* Generic.Deleted */
.syntax pre .ge { font-style: italic } /* Generic.Emph */
.syntax pre .gi { color: #a6e22e } /* Generic.Inserted */
.syntax pre .gs { font-weight: bold } /* Generic.Strong */
.syntax pre .gu { color: #75715e } /* Generic.Subheading */
.syntax pre .kc { color: #66d9ef } /* Keyword.Constant */
.syntax pre .kd { color: #66d9ef } /* Keyword.Declaration */
.syntax pre .kn { color: #f92672 } /* Keyword.Namespace */
.syntax pre .kp { color: #66d9ef } /* Keyword.Pseudo */
.syntax pre .kr { color: #66d9ef } /* Keyword.Reserved */
.syntax pre .kt { color: #66d9ef } /* Keyword.Type */
.syntax pre .ld { color: #e6db74 } /* Literal.Date */
.syntax pre .m { color: #ae81ff } /* Literal.Number */
.syntax pre .s { color: #e6db74 } /* Literal.String */
.syntax pre .na { color: #a6e22e } /* Name.Attribute */
.syntax pre .nb { color: #f8f8f2 } /* Name.Builtin */
.syntax pre .nc { color: #a6e22e } /* Name.Class */
.syntax pre .no { color: #66d9ef } /* Name.Constant */
.syntax pre .nd { color: #a6e22e } /* Name.Decorator */
.syntax pre .ni { color: #f8f8f2 } /* Name.Entity */
.syntax pre .ne { color: #a6e22e } /* Name.Exception */
.syntax pre .nf { color: #a6e22e } /* Name.Function */
.syntax pre .nl { color: #f8f8f2 } /* Name.Label */
.syntax pre .nn { color: #f8f8f2 } /* Name.Namespace */
.syntax pre .nx { color: #a6e22e } /* Name.Other */
.syntax pre .py { color: #f8f8f2 } /* Name.Property */
.syntax pre .nt { color: #f92672 } /* Name.Tag */
.syntax pre .nv { color: #f8f8f2 } /* Name.Variable */
.syntax pre .ow { color: #f92672 } /* Operator.Word */
.syntax pre .w { color: #f8f8f2 } /* Text.Whitespace */
.syntax pre .mb { color: #ae81ff } /* Literal.Number.Bin */
.syntax pre .mf { color: #ae81ff } /* Literal.Number.Float */
.syntax pre .mh { color: #ae81ff } /* Literal.Number.Hex */
.syntax pre .mi { color: #ae81ff } /* Literal.Number.Integer */
.syntax pre .mo { color: #ae81ff } /* Literal.Number.Oct */
.syntax pre .sb { color: #e6db74 } /* Literal.String.Backtick */
.syntax pre .sc { color: #e6db74 } /* Literal.String.Char */
.syntax pre .sd { color: #e6db74 } /* Literal.String.Doc */
.syntax pre .s2 { color: #e6db74 } /* Literal.String.Double */
.syntax pre .se { color: #ae81ff } /* Literal.String.Escape */
.syntax pre .sh { color: #e6db74 } /* Literal.String.Heredoc */
.syntax pre .si { color: #e6db74 } /* Literal.String.Interpol */
.syntax pre .sx { color: #e6db74 } /* Literal.String.Other */
.syntax pre .sr { color: #e6db74 } /* Literal.String.Regex */
.syntax pre .s1 { color: #e6db74 } /* Literal.String.Single */
.syntax pre .ss { color: #e6db74 } /* Literal.String.Symbol */
.syntax pre .bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
.syntax pre .vc { color: #f8f8f2 } /* Name.Variable.Class */
.syntax pre .vg { color: #f8f8f2 } /* Name.Variable.Global */
.syntax pre .vi { color: #f8f8f2 } /* Name.Variable.Instance */
.syntax pre .il { color: #ae81ff } /* Literal.Number.Integer.Long */
    </style>
	</head>
	<body class="landing">

		<!-- Header -->
			<header id="header">
				<h1><a href="index.html">Espresso</a></h1>
				<nav id="nav">
					<ul>
            <li><a href="index.html#writeup">Writeup</a></li>
						<li><a href="proposal.html">Proposal</a></li>
						<li><a href="checkpoint.html">Checkpoint</a></li>
					</ul>
				</nav>
			</header>

		<!-- Banner -->
			<section id="banner">
				<h2>Espresso</h2>
				<p>Speeding up and debittering Caffe by adding Halide</p>
				<ul class="actions">
					<li>
						<a href="https://www.github.com/jczhang/espresso" class="button big">View it on Github</a>
					</li>
				</ul>
			</section>

		<!-- One -->
			<section id="one" class="wrapper style1 align-center">
				<div class="container">
					<header>
						<h2>Summary</h2>
						<p>Espresso is a partial implementation of Caffe in the Halide image processing language. It supports fine-tuning of deep neural networks to achieve high evaluation performance on multiple platforms.</p>
					</header>
					<div class="row 200%">
						<section class="4u 12u$(small)">
							<i class="icon big rounded fa-coffee"></i>
							<p><a href="http://caffe.berkeleyvision.org/">Caffe</a> is a deep learning framework developed by the Berkeley Vision and Learning Center. It features GPU evaluation and training of convolutional neural networks with a clean interface. Models are described by configuration files and trained models can be exported.</p>
						</section>
						<section class="4u 12u$(small)">
							<i class="icon big rounded fa-photo"></i>
							<p><a href="http://halide-lang.org/">Halide</a> is an domain-specific language embedded in C++. It decouples algorithm implementations from scheduling and organization of computation, making it easier to optimize image processing pipelines for performance on multiple platforms.</p>
						</section>
						<section class="4u$ 12u$(small)">
							<i class="icon big rounded fa-angle-double-right"></i>
							<p><a href="https://github.com/jczhang/espresso">Espresso</a> is a deep learning framework implemented with the Halide language and philosophy in mind. We produce highly maintainable yet performant parallel code that is competitive with Caffe and works as a drop-in replacement for Caffe.</p>
						</section>
					</div>
				</div>
			</section>

		<!-- Two -->
			<section id="writeup" class="wrapper style2 align-center">
				<div class="container">
					<header>
						<h2>Preliminary Results</h2>
						<p>Friday, May 8, 2015</p>
					</header>
					<div class="row">
						<section class="feature 6u 12u$(small)">
							<h3 class="title">Halide algorithm</h3>
              <div class="syntax">
<pre style="text-align: left; padding: 1em;"><span class="n">Var</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">;</span>
<span class="n">RDom</span> <span class="nf">r</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">);</span>

<span class="c1">// pad boundaries with 0s</span>
<span class="n">Func</span> <span class="n">clamped</span> <span class="o">=</span>
  <span class="n">BoundaryConditions</span><span class="o">::</span><span class="n">constant_exterior</span><span class="p">(</span>
    <span class="n">input</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">input</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">input</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="n">Func</span> <span class="nf">output</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span>
  <span class="n">sum</span><span class="p">(</span><span class="n">clamped</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">r</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="n">r</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">kernel</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">y</span><span class="p">));</span> 
</pre>
</div>
              <p>This snippet of Halide code cleanly describes a simplified convolutional layer with an input image and a kernel. Notice that it follows the mathematical definition of the convolution very closely: \[ (I * K)[i, j] = \sum_m \sum_n I[i-m, j-n]K[m, n] \]</p>
<!--
              <pre style="text-align: left">
Var i, j, k, l;
RDom r(0, kernel_size, 0, kernel_size);

// pad boundaries with 0s
Func clamped =
  BoundaryConditions::constant_exterior(
    input, 0.0f, 0, input.x, 0, input.y);
Func output(i, j) =
  sum(clamped(i - r.x, j - r.y) * kernel(r.x, r.y)); 
</pre>
-->
						</section>
						<section class="feature 6u$ 12u$(small)">

							<h3 class="title">Halide scheduling</h3>
              <div class="syntax">
<pre style="text-align: left; padding: 1em;"><span class="n">Var</span> <span class="n">i_inner</span><span class="p">,</span> <span class="n">i_outer</span><span class="p">,</span> <span class="n">j_inner</span><span class="p">,</span> <span class="n">j_outer</span><span class="p">,</span> <span class="n">tile_index</span><span class="p">;</span>
<span class="n">output</span><span class="p">.</span><span class="n">tile</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span>
        <span class="n">i_outer</span><span class="p">,</span> <span class="n">j_outer</span><span class="p">,</span>
        <span class="n">i_inner</span><span class="p">,</span> <span class="n">j_inner</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
  <span class="p">.</span><span class="n">unroll</span><span class="p">(</span><span class="n">i_inner</span><span class="p">).</span><span class="n">unroll</span><span class="p">(</span><span class="n">j_inner</span><span class="p">)</span>
  <span class="p">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">i_outer</span><span class="p">,</span> <span class="n">j_outer</span><span class="p">,</span> <span class="n">tile_index</span><span class="p">)</span>
  <span class="p">.</span><span class="n">parallel</span><span class="p">(</span><span class="n">tile_index</span><span class="p">)</span>
  <span class="p">.</span><span class="n">compute_root</span><span class="p">();</span>
</pre>
              <p>This snippet of Halide code describes the allocation of computational resources of the algorithm. Modifying the scheduling to target different architectures will not affect the correctness of the code. Notice that this code splits the output into $4 \times 4$ tiles, unrolls an inner loop computing those tiles, and creates an outer loop indexed by <code>tile_index</code>, which runs in parallel and stores computations to memory.</p>
</div>
<!--
<pre style="text-align: left">
Var i_inner, i_outer, j_inner, j_outer, tile_index;
output.tile(i, j,
        i_outer, j_outer,
        i_inner, j_inner,
        4, 4)
  .unroll(i_inner).unroll(j_inner)
  .fuse(i_outer, j_outer, tile_index)
  .parallel(tile_index)
  .compute_root();
</pre>
-->
						</section>
						<section class="feature 6u 12u$(small)">
              <!--<img class="image fit" src="images/pic03.jpg" alt="" />-->
							<h3 class="title">Preliminary performance results</h3>
              <p>We have found that Halide is sufficiently expressive enough for neural network implementation without additional modifications to the Halide compiler. Up to now, we've reimplemented most of the Caffe layers in Halide and can load them from Caffe configuration files.</p>
              <p>We are able to run Caffe's reference network end-to-end on the CPU and GPU, achieving over 320x speedup from the sequential, unscheduled code. In terms of raw numbers, a 4770K Core i7 processor can evaluate an image in 320 ms. Using a GTX 770 GPU, an image can be evaluated in 400 ms (slower due to memory issues; we're still working on that). We have ideas for many more optimizations that will help us push that number down to the sub-10 ms range.</p>
              <p>Timing individual layers on the GPU vs the CPU, we achieve a 2x speedup on convolutional layers, 8x speedup on pooling layers, and 9x speedup on local region normalization.</p>
						</section>
						<section class="feature 6u$ 12u$(small)">
							<h3 class="title">Final results to be shown</h3>
              <p>On Monday, May 11, 2015, we'll give a presentation that demonstrates performance results competitive with Caffe and <a href="https://github.com/soumith/convnet-benchmarks">other benchmarks</a>. We'll give a demo that shows Espresso's user-friendliness in applications, development, and research. We'll also explain the challenges of competing with existing GPU deep learning implementations and the gotchas of writing parallel neural network code in Halide.</p>
              <img class="image fit" src="images/dnn.png" alt="" />
						</section>
					</div>
				</div>
			</section>

		<!-- Footer -->
			<footer id="footer">
				<div class="container">
					<div class="row">
						<section class="4u 6u(medium) 12u$(small)">
							<h3>Made by</h3>
							<p><a href="https://www.github.com/jczhang">Jeffrey Zhang</a> and <a href="https://www.github.com/iambald">Jeff Chen</a></p>						</section>
						<section class="4u 6u$(medium) 12u$(small)">

							<h3>for</h3>
							<p><a href="http://15418.courses.cs.cmu.edu/spring2015/article/13">the 15-418 Spring 2015 Parallelism Competition</a></p>
						</section>
						<section class="4u$ 12u$(medium) 12u$(small)">
							<h3>with</h3>
              <p><a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">&hearts;</a></p>
						</section>
					</div>
					<ul class="copyright">
						<li>Design by <a href="http://templated.co">TEMPLATED</a></li>
						<li>Images by <a href="http://unsplash.com">Unsplash</a></li>
					</ul>
				</div>
			</footer>

	</body>
</html>
